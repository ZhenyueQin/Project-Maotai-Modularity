from scipy.spatial.distance import pdist, squareform
import numpy as np
import statistics

from numbapro import jit, float32

def distcorr(X, Y):
    """ Compute the distance correlation function

    >>> a = [1,2,3,4,5]
    >>> b = np.array([1,2,9,4,4])
    >>> distcorr(a, b)
    0.762676242417
    """
    X = np.atleast_1d(X)
    Y = np.atleast_1d(Y)
    if np.prod(X.shape) == len(X):
        X = X[:, None]
    if np.prod(Y.shape) == len(Y):
        Y = Y[:, None]
    X = np.atleast_2d(X)
    Y = np.atleast_2d(Y)
    n = X.shape[0]
    if Y.shape[0] != X.shape[0]:
        raise ValueError('Number of samples must match')
    a = squareform(pdist(X))
    b = squareform(pdist(Y))
    A = a - a.mean(axis=0)[None, :] - a.mean(axis=1)[:, None] + a.mean()
    B = b - b.mean(axis=0)[None, :] - b.mean(axis=1)[:, None] + b.mean()

    dcov2_xy = (A * B).sum() / float(n * n)
    dcov2_xx = (A * A).sum() / float(n * n)
    dcov2_yy = (B * B).sum() / float(n * n)
    dcor = np.sqrt(dcov2_xy) / np.sqrt(np.sqrt(dcov2_xx) * np.sqrt(dcov2_yy))
    return dcor

if __name__ == '__main__':
    fits = [0.9462095446971507, 0.7268537398616537, 0.7974497637894071, 0.0013293636759662553, 0.018270554670743677, 0.0021405233946036883, 2.285773878323294E-4, 0.014071618291109034, 0.4585493414911641, 0.08900802234697425, 3.269889223951328E-4, 0.0, 0.3464658342192465, 0.001612092632511053, 0.3960174667948557, 0.0, 0.0, 0.0, 0.0, 0.017806278608604842, 0.0, 0.33240207280668754, 0.004597399456685025, 0.025219381530457552, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.08069203501237643, 2.148945968949434E-7, 1.982878034101354E-6, 0.030252935756523103, 0.030252935756523103, 0.0, 0.0, 0.032045978064604186, 0.0, 0.01021524234302218, 0.0, 0.0, 0.02399741987814319, 0.02037589840337517, 0.024725935575696134, 1.1404210081333854E-4, 0.08066062802287044, 0.17055411389075115, 0.030244625096607747, 0.17754001840237343, 0.030252935756523103, 0.0, 0.08948963861996584, 0.0, 0.007263492402573846, 1.0367462541449601E-4, 0.0, 0.06225662162485135, 0.0, 0.0, 0.0, 0.0, 0.0, 0.007263492402573846, 0.0012997181347903508, 0.06325548062402675, 0.20806819842675062, 0.17986637936076, 0.20806819842675062, 5.2345380141538556E-8, 0.3960174667948557, 0.19793640832844406, 0.0, 0.0, 2.0912968820785416E-5, 0.03438685886820403, 0.11637021950929838, 7.870101449325428E-4, 0.022442956997525076, 0.030252935756523103, 0.0, 5.101349933678279E-4, 0.0, 0.0, 0.0, 0.0, 0.0029718164196589347, 0.0, 0.0, 0.05712084185170452, 0.1754306333181378, 0.04655958774821689, 0.20806819842675062, 0.2967751089371501, 0.010542963139542283, 0.16211724425750929, 0.04153246281332312, 0.05799322241269089]
    dists = list(range(len(fits)))

    fit_stdev = statistics.stdev(fits)
    dist_stdev = statistics.stdev(dists)